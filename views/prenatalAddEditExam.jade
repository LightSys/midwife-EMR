extends layouts/default_layout

block prenatalAddEditExam
  +titleMsg(title)
  +patientWell(rec)

  - var prenatalPath = '/pregnancy/' + rec.id + '/prenatal';
  - var prenatalExamDeletePath;
  - var defaultDate = libs.mmt().format('YYYY-MM-DD');

  //- Default for adding a new prenatal exam.
  - var formId = 'addPrenatalExamForm';
  - var formName = 'prenatalAddExam';
  - var formAction = '/pregnancy/' + rec.id + '/prenatalexam';
  - var returnDate;
  - var ga = rec.ga;

  //- Adjust for editing an existing prenatal exam.
  - if (prenatalExam) {
  -   formId = 'editPrenatalExamForm';
  -   formName = 'prenatalEditExam';
  -   formAction = '/pregnancy/' + rec.id + '/prenatalexam/' + prenatalExam.id;
  -   defaultDate = libs.mmt(prenatalExam.date).format('YYYY-MM-DD');
  -   returnDate = prenatalExam.returnDate? libs.mmt(prenatalExam.returnDate).format('YYYY-MM-DD'): void(0);
  -   prenatalExamDeletePath = '/pregnancy/' + rec.id + '/prenatalexam/' + prenatalExam.id + '/delete';
  -   ga = prenatalExam.ga;
  - } else {
  -   // So that exceptions are not thrown in value attributes below.
  -   prenatalExam = {};
  - }

  div
    form(id=formId, class='dirty-check', role='form', name=formName, action=formAction, method='post')
      div.row
        div(class='form-group col-md-3')
          label(class='')= gettext('Mother Information')
          div= gettext('Date')
          +datePicker('form-control', 1, 'date', defaultDate, 'date')
          span= gettext('Weight')
          input(id='weight', class='form-control', type='number', step="0.1", min="30", max="200", tabindex="2", autocomplete="off", name='weight', autofocus, disabled=readonlyFields.weight, value=prenatalExam.weight)
          div.row
            div.col-md-6
              span= gettext('Systolic')
              input(id='systolic', class='form-control', type='number', tabindex="3", autocomplete="off", name='systolic', disabled=readonlyFields.systolic, value=prenatalExam.systolic)
            div.col-md-6
              span= gettext('Diastolic')
              input(id='diastolic', class='form-control', type='number', tabindex="4", autocomplete="off", name='diastolic', disabled=readonlyFields.diastolic, value=prenatalExam.diastolic)
          div.row
            div.col-md-6
              div= gettext('CR')
              input(id='cr', class='form-control', type='number', tabindex="5", autocomplete="off", name='cr', disabled=readonlyFields.cr, value=prenatalExam.cr)
            div.col-md-6
              div= gettext('Temperature')
              input(id='cr', class='form-control', type='number', step="0.1", tabindex="6", autocomplete="off", name='temperature', disabled=readonlyFields.temperature, value=prenatalExam.temperature)
          div.row
            div.col-md-6
              div= gettext('RR')
              input(id='cr', class='form-control', type='number', tabindex="7", autocomplete="off", name='respiratoryRate', disabled=readonlyFields.respiratoryRate, value=prenatalExam.respiratoryRate)

        div(class='form-group col-md-3')
          label(class='')= gettext('Fetus Information')
          div= gettext('GA')
          input(id='ga', class='form-control', type='text', autocomplete="off", name='ga', disabled=true, value=ga)
          div.row
            div.col-md-6
              span= gettext('FH')
              input(id='fh', class='form-control', type='number', tabindex="8", autocomplete="off", name='fh', disabled=readonlyFields.fh, value=prenatalExam.fh)
            div.col-md-6
              span= gettext('FHT')
              input(id='fht', class='form-control', type='number', tabindex="9", autocomplete="off", name='fht', disabled=readonlyFields.fht, value=prenatalExam.fht)
          span= gettext('FHT Note')
          input(id='fhtNote', class='form-control', type='text', tabindex='10', spellcheck="off", autocomplete='off', name='fhtNote', disabled=readonlyFields.fhtNote, value=prenatalExam.fhtNote)
          span= gettext('Position (saved all caps)')
          input(id='pos', class='form-control', type='text', tabindex="11", autocomplete="off", name='pos', disabled=readonlyFields.pos, value=prenatalExam.pos)

        div(class='form-group col-md-3')
          label(class='')= gettext('Other Information')
          div.checkbox
            label= gettext('Mvmt')
              input(type='checkbox', name='mvmt', tabindex="12", disabled=readonlyFields.mvmt, value=1, checked=prenatalExam.mvmt==true)
          div.checkbox
            label= gettext('Edema')
              +select('form-control', 'edema', 13, edema, readonlyFields.edema)
          span= gettext('Risk')
              input(class='form-control', type='text', name='risk', spellcheck="off", autocomplete="off", tabindex="14", disabled=readonlyFields.risk, value=prenatalExam.risk)
          div.checkbox
            label= gettext('Vitamin')
              input(type='checkbox', name='vitamin', tabindex="15", disabled=readonlyFields.vitamin, value=1, checked=prenatalExam.vitamin==true)
          div.checkbox
            label= gettext('Pray')
              input(type='checkbox', name='pray', tabindex="16", disabled=readonlyFields.pray, value=1, checked=prenatalExam.pray==true)

        div(class='form-group col-md-3')
          label(class='')= gettext('Other continued')
          div= gettext('Notes')
          textarea(id='note', class='form-control', tabindex="17", spellcheck="off", autocomplete="off", wrap="soft", rows="4", disabled=readonlyFields.note, name='note')= prenatalExam.note
          div= gettext('Return Date')
          +datePicker('form-control', 18, 'returnDate', returnDate, 'returnDate', '+1m', readonlyFields.returnDate)


      div.row
        - var backOffset = 'col-md-offset-9';
        - if (prenatalExamDeletePath) {
        - var backOffset = 'col-md-offset-7';
        div(class='form-group col-md-2')
          button(class='btn disable-on-change', data-toggle='modal', data-target="#delete-modal")= gettext('Delete')
        - }
        div(class='form-group col-md-2 ' + backOffset)
          a(href=prenatalPath, class='btn btn-default pull-right disable-on-change', role='button')= gettext('Back to the Prenatal Page')
        div(class='form-group col-md-1')
          button(class='btn btn-primary pull-right', type='submit')= gettext('Save')
          input(type='hidden', name='_csrf', value=token)
          input(type='hidden', name='pregnancy_id', value=rec.id)
          input(type='hidden', name='id', value=prenatalExam.id)

    - if (prenatalExamDeletePath) {
    div(id='delete-modal', class='modal fade', tabindex='-1', role='dialog', aria-labelledby='deleteModalheader', aria-hidden='true')
      form(id='deletePrenatalExamForm', role='form', name='prenatalExamDelete', action=prenatalExamDeletePath, method='post')
        div(class='modal-dialog')
          div(class='modal-content')
            div(class='modal-header')
              h3(id='deleteModalHeader', class='modal-title text-center')= gettext('Are you sure?')
            div(class='modal-body')
              p(class='text-warning lead')= gettext('The deletion cannot be undone. Press Delete or Cancel.')
            div(class='modal-footer')
              input(type='hidden', name='_csrf', value=token)
              input(type='hidden', name='pregnancy_id', value=rec.id)
              input(type='hidden', name='id', value=prenatalExam.id)
              button(type='button', class='btn btn-default', data-dismiss='modal')= gettext('Cancel')
              button(type='submit', class='btn btn-primary')= gettext('Delete')
    - }
