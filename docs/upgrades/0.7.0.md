# 0.7.0

### SQL changes

The user_role join table was eliminated because the application assumes that
there is a one to one relationship between a user and a role and therefore the
one to many capability allowed by the join table is not necessary. It just make
user/role maintenance more complicated.

**Perform a database backup before running this SQL.**

```
ALTER TABLE user ADD COLUMN role_id INT AFTER isCurrentTeacher;
ALTER TABLE user ADD FOREIGN KEY (role_id) REFERENCES role (id) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE userLog ADD COLUMN role_id INT AFTER isCurrentTeacher;
ALTER TABLE userLog ADD FOREIGN KEY (role_id) REFERENCES role (id) ON DELETE NO ACTION ON UPDATE NO ACTION;

UPDATE user u SET role_id = (SELECT role_id FROM user_role ur WHERE ur.user_id = u.id LIMIT 1);
UPDATE userLog u SET u.role_id = (SELECT ur.role_id FROM user_roleLog ur WHERE ur.user_id = u.id LIMIT 1);

DROP TABLE user_role;
DROP TABLE user_roleLog;
```

Source the ```database/sql/create_log_triggers.sql``` table in order
to recreate the triggers to match the changes to the schema structure.

Add the keyValue table and some records, but adjust the records per the installation site.

```
CREATE TABLE IF NOT EXISTS `keyValue` (
  id INT AUTO_INCREMENT PRIMARY KEY,
  kvKey VARCHAR(50) NOT NULL,
  kvValue VARCHAR(200) NULL,
  description VARCHAR(200) NULL,
  valueType ENUM('text', 'list', 'integer', 'decimal', 'date', 'boolean') NOT NULL,
  acceptableValues VARCHAR(500) NULL,
  systemOnly TINYINT NOT NULL DEFAULT 0,
  UNIQUE(kvKey)
);
```

SELECT 'keyValue' AS 'Loading' FROM DUAL;
INSERT INTO keyValue
  (kvKey, kvValue, description, valueType, acceptableValues, systemOnly)
VALUES
  ('siteShortName', 'YourClinic', 'A relatively short name for the clinic, i.e. under 10 characters.', 'text', '', 0),
  ('siteLongName', 'Your Full Clinic Name', 'The full name for the clinic.', 'text', '', 0),
  ('address1', 'Street Address Line 1', 'The first line of the street address.', 'text', '', 0),
  ('address2', 'Street Address Line 2', 'The second line of the street address.', 'text', '', 0),
  ('address3', 'Street Address Line 3', 'The third line of the street address, if there is one.', 'text', '', 0),
  ('defaultCity', 'Home Town Name', 'The default locality you want to use that most of your patients come from.', 'text', '', 0),
  ('searchRowsPerPage', '20', 'The number of rows of search results to display per page.', 'integer', '', 0),
  ('customField1', 'Custom1', 'The label on the custom field on the general prenatal tab.', 'text', '', 0),
  ('dateFormat', 'YYYY-MM-DD', 'The date format to use.', 'list', 'MM-DD-YYYY|DD-MM-YYYY|YYYY-MM-DD|MM/DD/YYYY|DD/MM/YYYY|YYYY/MM/DD|MM.DD.YYYY|DD.MM.YYYY|YY.MM.DD', 0)
;
